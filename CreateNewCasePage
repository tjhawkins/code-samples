<%@ Page Title="" Language="vb" AutoEventWireup="false" MasterPageFile="~/SCCRM.Master" CodeBehind="CreateNewCase.aspx.vb" Inherits="SCCRM.CreateNewCase" %>

<%@ Register Assembly="Infragistics4.WebUI.WebSchedule.v13.1, Version=13.1.20131.2107, Culture=neutral, PublicKeyToken=7dd5c3163f2cd0cb" Namespace="Infragistics.WebUI.WebSchedule" TagPrefix="igsch" %>

<%@ Register Assembly="Infragistics4.Web.v13.1, Version=13.1.20131.2107, Culture=neutral, PublicKeyToken=7dd5c3163f2cd0cb" Namespace="Infragistics.Web.UI.EditorControls" TagPrefix="ig" %>

<%@ Register Assembly="Infragistics4.Web.v13.1, Version=13.1.20131.2107, Culture=neutral, PublicKeyToken=7dd5c3163f2cd0cb" Namespace="Infragistics.Web.UI.GridControls" TagPrefix="ig" %>
<asp:Content ID="Content1" ContentPlaceHolderID="head" runat="server">
    <link href="Styles/Themes/Message/jquery-ui-1.8.23.custom.css" rel="stylesheet" />



</asp:Content>
<asp:Content ID="Content2" ContentPlaceHolderID="ContentPlaceHolder" runat="server">
    <asp:HiddenField runat="server" ID="employeeID" ClientIDMode="Static" />
    <asp:HiddenField runat="server" ID="caseNumberField" ClientIDMode="Static" />
   <asp:HiddenField runat="server" ID="empName" ClientIDMode="Static" />
    <asp:HiddenField runat="server" ID="TypeOfCase" ClientIDMode="Static" Value="Employee" />
    <asp:UpdatePanel runat="server" ID="contentUpdate" ClientIDMode="Static" ChildrenAsTriggers="true" UpdateMode="Always">

        <ContentTemplate>

            <asp:Panel runat="server" ID="caseHeader" ClientIDMode="Static">
                <h1 id="caseText">Case Number:<asp:Label runat="server" ID="caseNumber" ClientIDMode="Static" CssClass="caseNumber"></asp:Label></h1>
                <p id="dateText">
                    Created:
                <asp:Label runat="server" ID="caseDate" ClientIDMode="Static" CssClass=""></asp:Label>
                </p>
            </asp:Panel>
            <asp:Panel runat="server" ID="searchFieldsetWrapper" CssClass="four column" ClientIDMode="Static">
             
                <fieldset id="regionFieldset">
                    <legend>Begin Case</legend>
                    <div id="searchMessageWrapper" class="message twelve clear caseMessageWrapper">
                        <p id="newCaseSearchMessage" class="ui-state-highlight">Please select a region and Case Type. For employee cases, please choose a search option, and enter the caller's information.</p>
                    </div>
                    <div id="newCaseSearch" class="twelve column has-dropdown ">
                        <div class="twelve has-dropdown formDDLWrapper">
                            <asp:Label runat="server" ID="regionLabel" ClientIDMode="Static" CssClass="formLabel">Region<span class="required">*</span>
                                <asp:RequiredFieldValidator runat="server" ID="RequiredFieldValidator1" ClientIDMode="Static" CssClass="formValidator errorText" ControlToValidate="region" ValidationGroup="case" Text="! Region is  not selected"></asp:RequiredFieldValidator>
                            </asp:Label>
                           
                            <div class="clear"></div>
                            <asp:DropDownList runat="server" ID="region" ClientIDMode="Static" CssClass="case formDDL" TabIndex ="1"></asp:DropDownList>
                        </div>
                        <div class="twelve has-dropdown formDDLWrapper">
                            <asp:Label runat="server" ID="caseTypeLabel" ClientIDMode="Static" CssClass="formLabel">Case Type<span class="required">*</span>
                                 <asp:RequiredFieldValidator runat="server" ID="caseTypeValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="caseType" ValidationGroup="case" Display="Dynamic" Text="! Case Type is not selected"></asp:RequiredFieldValidator>
                                <span id="casetypeSearchValidator" class="formValidator errorText requiredFieldValidator"></span>
                            </asp:Label>
                           
                            <div class="clear"></div>
                            <asp:DropDownList runat="server" ID="caseType" ClientIDMode="Static" CssClass="case formDDL" TabIndex ="2"></asp:DropDownList>
                            <asp:DropDownList runat="server" ID="caseTypeCategory" ClientIDMode="Static" CssClass="case formDDL" TabIndex ="3">
                                <asp:ListItem Text="Employee" Value="Employee" Selected="True"></asp:ListItem>
                                <asp:ListItem Text="Plaza" Value="Plaza"></asp:ListItem>
                                <asp:ListItem Text="Other" Value="Other"></asp:ListItem>
                            </asp:DropDownList>
                            <div class="clear"></div>
                        </div>
                        <div id="optionsWrapper" class=" twelve clear">
                            <div id="optionsInnerWrapper">
                                <div id="newCaseSearchOptionsWrapper" class="twelve searchOptionsWrapper selectedOptionsWrapper">
                                    <fieldset id="newCaseSearchOptionsFieldset" class="">
                                        <legend>Search Options</legend>
                                        <asp:RadioButtonList runat="server" ID="newCaseSearchOptions" ClientIDMode="Static" CssClass="searchOptions selectOptions" RepeatDirection="Horizontal" RepeatLayout="Table" >
                                            <asp:ListItem Text="Name" Value="Name" Selected="True"></asp:ListItem>
                                            <asp:ListItem Text="Employee ID" Value="EID"></asp:ListItem>
                                            <asp:ListItem Text="Phone 1" Value="PhoneOne"></asp:ListItem>
                                            <asp:ListItem Text="Phone 2" Value="PhoneTwo"></asp:ListItem>

                                        </asp:RadioButtonList>
                                    </fieldset>
                                </div>
                                
                                <div id="newCaseNameField" class="twelve searchOptionWrapper">
                                    <asp:Label runat="server" ID="fNameLabel" ClientIDMode="Static" CssClass="formLabel">First Name
                                        <asp:RegularExpressionValidator runat="server" ID="fNameExpressionValidator" CssClass="formValidator" ControlToValidate="fName" ValidationGroup="case" Display="Dynamic" ValidationExpression="^[a-zA-Z '-]*$" Text="! First Name is not valid"></asp:RegularExpressionValidator>
                                        <span id="requiredNameValidator" class="formValidator errorText requiredFieldValidator">! Please enter a Name</span>
                                    </asp:Label>
                                    
                                    <asp:TextBox runat="server" ID="fName" ClientIDMode="Static" CssClass=" formField" TabIndex="4"></asp:TextBox>
                                    <asp:Label runat="server" ID="lNameLabel" ClientIDMode="Static" CssClass="formLabel">Last Name
                                        <asp:RegularExpressionValidator runat="server" ID="lNameExpressionValidator" CssClass="formValidator" ControlToValidate="lName" ValidationGroup="case" Display="Dynamic" ValidationExpression="^[a-zA-Z '-]*$" Text="! Last name is not valid"></asp:RegularExpressionValidator>
                                    </asp:Label>
                                    
                                    <asp:TextBox runat="server" ID="lName" ClientIDMode="Static" CssClass="formField" TabIndex="5"></asp:TextBox>
                                </div>
                                <div id="newCaseEIDField" class="twelve searchOptionWrapper hide">
                                    <asp:Label runat="server" ID="employeeIDLabel" ClientIDMode="Static" CssClass="formLabel">Employeee ID
                                         <span id="requiredEIDValidator" class="formValidator errorText requiredFieldValidator">! Please enter an Employee ID</span>
                                    </asp:Label>
                                    <asp:TextBox runat="server" ID="eid" ClientIDMode="Static" CssClass=" formField" TabIndex="4"></asp:TextBox>
                                </div>

                                <div id="newCasePhoneOneField" class="twelve searchOptionWrapper hide">
                                    <asp:Label runat="server" ID="phoneOneLabel" ClientIDMode="Static" CssClass="formLabel">Phone 1 (ex.555-555-5555)
                                        <asp:RegularExpressionValidator runat="server" ID="phoneOneExpValidator" CssClass="formValidator" ControlToValidate="phoneOne" Display="Dynamic" ValidationGroup="case" ValidationExpression="((\(\d{3}\) ?)|(\d{3}-))?\d{3}-\d{4}" Text="Phone 1 is not valid"></asp:RegularExpressionValidator>
                                         <span id="requiredPhoneValidator" class="formValidator errorText requiredFieldValidator">! Please enter a Phone Number</span>
                                    </asp:Label>
                                    <asp:TextBox runat="server" ID="phoneOne" ClientIDMode="Static" CssClass=" formField" TabIndex="4"></asp:TextBox>
                                </div>

                                <div id="newCasePhoneTwoField" class="twelve searchOptionWrapper hide">
                                    <asp:Label runat="server" ID="phoneTwoLabel" ClientIDMode="Static" CssClass="formLabel">Phone 2 (ex.555-555-5555)
                                        <asp:RegularExpressionValidator runat="server" ID="phoneTwoExpValidator" CssClass="formValidator" ControlToValidate="phoneTwo" Display="Dynamic" ValidationGroup="case" ValidationExpression="((\(\d{3}\) ?)|(\d{3}-))?\d{3}-\d{4}" Text="Phone 2 is not valid"> </asp:RegularExpressionValidator>
                                         <span id="requiredAltPhoneValidator" class="formValidator errorText requiredFieldValidator">! Please enter a Phone Number</span>
                                    </asp:Label>
                                    <asp:TextBox runat="server" ID="phoneTwo" ClientIDMode="Static" CssClass="formField" TabIndex="4"></asp:TextBox>
                                </div>
                             </div>
                        
                        </div>
                    </div>
                    <div id="searchBtnWrapper" class="twelve">
                        <asp:Button ID="newCaseSearchBtn" CssClass="medium button rightButton" ClientIDMode="Static" runat="server" Text="Search" ValidationGroup="case" TabIndex="5" />
                    </div>
                </fieldset>
            </asp:Panel>
            <asp:Panel runat="server" ID="resultsWrapper" CssClass=" eight column" ClientIDMode="Static">
                <fieldset id="resultsFieldset" class="">
                    <legend>Results</legend>
                    <div id="resultsAlertMessageWrapper" class="twelve column alert-box alert">
                        <asp:Label runat="server" ID="searchResultsMessage" ClientIDMode="Static" CssClass=""> </asp:Label>
                    </div>
                    <div id="resultsSuccessMessageWrapper" class="twelve column alert-box success">
                        <asp:Label runat="server" ID="caseSuccessMessage" ClientIDMode="Static" CssClass=""> </asp:Label>
                    </div>

                    <div id="employeeSelectMessage" class="message row hide">
                        <p id="P5" class="ui-state-highlight">Please select the desired employee.</p>
                    </div>
                    <ig:WebDataGrid ID="employeeSearchResultsGrid" ClientIDMode="Static" CssClass="hide grid" ItemCssClass="pointer" runat="server" StyleSetName="IG">
                        <ClientEvents Click="employeeSearchResultsGrid_Grid_Click" />
                        <Behaviors>
                            <ig:Selection CellClickAction="Row" RowSelectType="Single" SelectedCellCssClass="activeRow">
                            </ig:Selection>
                        </Behaviors>
                    </ig:WebDataGrid>
                </fieldset>
                <div class="four">
                 
                     <asp:Button runat="server" ID="newCaseBackBtn" ClientIDMode="Static" CssClass="medium button rightButton" Text="Back" />
                    <asp:Button runat="server" ID="newCaseNextBtn" ClientIDMode="Static" CssClass="medium button" Text="Next" />
                </div>
            </asp:Panel>
            <asp:Panel runat="server" ID="caseInfoWrapper" ClientIDMode="Static">
                <fieldset id="caseFieldset" class="twelve">
                    <legend>Case Information</legend>
                    <asp:Panel runat="server" ID="empInfoWrapper" ClientIDMode="Static" CssClass="three column empInfoWrapper">
                        <asp:Panel runat="server" ID="caseEmployeeInfo" ClientIDMode="Static" CssClass="twelve column empInfoPanel">
                            <asp:Label runat="server" ID="NameText" ClientIDMode="Static" CssClass="blockLabel"><strong>Name: </strong>
                                <asp:Label runat="server" ID="Name" ClientIDMode="Static" CssClass="blockText"></asp:Label></asp:Label>
                            <asp:Panel runat="server" ID="EmpoyeeIDText" ClientIDMode="Static" CssClass="blockLabel">
                                <strong>Employee ID: </strong>
                                <asp:Label runat="server" ID="caseEID" ClientIDMode="Static" CssClass="blockText"></asp:Label>
                            </asp:Panel>
                            <asp:Panel runat="server" ID="p1" ClientIDMode="Static" CssClass="blockLabel"><strong>Phone 1: </strong>
                                <asp:Label runat="server" ID="phoneOneText" ClientIDMode="Static" CssClass="blockText"></asp:Label></asp:Panel>
                            <asp:Panel runat="server" ID="p2" ClientIDMode="Static" CssClass="blockLabel"><strong>Phone 2: </strong>
                                <asp:Label runat="server" ID="phoneTwoText" ClientIDMode="Static" CssClass="blockText"></asp:Label></asp:Panel>
                            <asp:Panel runat="server" ID="P3" ClientIDMode="Static" CssClass="blockLabel">
                                <strong>Region: </strong>
                                <asp:Label runat="server" ID="caseRegion" ClientIDMode="Static" CssClass="blockText"></asp:Label>
                            </asp:Panel>
                            <asp:Panel runat="server" ID="P4" ClientIDMode="Static" CssClass="blockLabel">
                                <strong>Case Type: </strong>
                                <asp:Label runat="server" ID="cTypeText" ClientIDMode="Static" CssClass="blockText"></asp:Label>
                            </asp:Panel>
                        </asp:Panel>
                    </asp:Panel>
                    <div id="caseInfo" class="nine column formSection">
                        <asp:Panel runat="server" ID="plazaWrapper" ClientIDMode="Static" CssClass="twelve has-dropdown formDDLWrapper">
                            <asp:Label runat="server" ID="plazaLabel" ClientIDMode="Static" CssClass="formLabel">Plaza<span class="required">*</span>
                                <asp:RequiredFieldValidator runat="server" ID="plazaValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="plaza" ValidationGroup="caseInfo"  Text="! A plaza is not selected."></asp:RequiredFieldValidator>

                            </asp:Label>
                            <div class="clear"></div>
                            <asp:DropDownList runat="server" ID="plaza" ClientIDMode="Static" CssClass="caseInfo formDDL" TabIndex="1"></asp:DropDownList>
                        </asp:Panel>
                        <asp:Panel runat="server" ID="positionWrapper" ClientIDMode="Static" CssClass="twelve has-dropdown formDDLWrapper">
                            <asp:Label runat="server" ID="positionLabel" ClientIDMode="Static" CssClass="formLabel">Position<span class="required">*</span>
                                 <asp:RequiredFieldValidator runat="server" ID="positionValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="position" ValidationGroup="caseInfo" Text="! A position is not selected"></asp:RequiredFieldValidator>
                            </asp:Label>
                           
                            <div class="clear"></div>
                            <asp:DropDownList runat="server" ID="position" ClientIDMode="Static" CssClass="caseInfo formDDL" TabIndex="2"></asp:DropDownList>
                        </asp:Panel>
                        <div id="reasonWrapper" class="twelve has-dropdown formDDLWrapper">
                            <asp:Label runat="server" ID="reasonLabel" ClientIDMode="Static" CssClass="formLabel">Reason<span class="required">*</span>
                                <asp:RequiredFieldValidator runat="server" ID="reasonValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="reason" ValidationGroup="caseInfo" Text="! A reason is not selected"></asp:RequiredFieldValidator>
                            </asp:Label>
                            <div class="clear"></div>
                            <asp:DropDownList runat="server" ID="reason" ClientIDMode="Static" CssClass="caseInfo formDDL" TabIndex="3"></asp:DropDownList>
                        </div>
                        <asp:Panel runat="server" ID="notifiedWrapper" ClientIDMode="Static" CssClass="twelve">
                            <asp:Panel runat="server" ID="caseErrorMessageWrapper" ClientIDMode="Static" CssClass="message twelve clear">
                                <p id="P7" class="ui-state-highlight">If supervisor is unavailable, please enter <strong>N/A</strong></p>
                            </asp:Panel>
                            <div>
                            <asp:Label runat="server" ID="notifiedLabel" ClientIDMode="Static" CssClass="formLabel">Notified<span class="required">*</span>
                                <asp:RequiredFieldValidator runat="server" ID="notifiedValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="notified" ValidationGroup="caseInfo" Display="Dynamic"  Text="! A name is required. If unavailable, enter N/A"></asp:RequiredFieldValidator>
                            <asp:RegularExpressionValidator runat="server" ID="notifiedExpValidator" CssClass="formValidator" ClientIDMode="Static" ControlToValidate="notified" ValidationGroup="caseInfo" Display="Dynamic" ValidationExpression="^[a-zA-Z '-/]*$" Text="! Name is invalid"></asp:RegularExpressionValidator>
                            </asp:Label>
                            
                             <div class="clear"></div>
                            <asp:TextBox runat="server" ID="notified" ClientIDMode="Static" CssClass="caseInfo formField" TabIndex="4"></asp:TextBox>
                                </div>
                        </asp:Panel>

                        <asp:Panel runat="server" ID="shiftWrapper" ClientIDMode="Static" CssClass="twelve borderTop">
                            <div id="shiftInWrapper" class="twelve shiftInWrapper">
                                <div id="" class="six shiftDateWrapper column">
                                    <asp:Label runat="server" ID="shiftDateLabel" ClientIDMode="Static" CssClass="formLabel">Shift Date<span class="required">*</span>
                                         <asp:RequiredFieldValidator runat="server" ID="shiftDateRequiredValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="shiftDate" ValidationGroup="caseInfo" Display="Dynamic"  Text="! A date is required"></asp:RequiredFieldValidator>
                                        <asp:RegularExpressionValidator runat="server" ID="shiftDateExpValidator" CssClass="formValidator" ClientIDMode="Static" ControlToValidate="shiftDate" ValidationGroup="caseInfo" Display="Dynamic" ValidationExpression="^(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.](19|20)\d\d$" Text="! Shift Date is invalid."></asp:RegularExpressionValidator>
                                        <asp:Label runat="server" ID="shiftDateValidator" ClientIDMode="Static" CSSClass="formValidator errorText requiredFieldValidator">! Shift Date is after Shift End Date</asp:Label>
                                    </asp:Label>
                                   
                                    <div class="clear"></div>
                                    <ig:WebDatePicker ID="shiftDate" ClientIDMode="Static" CssClass="dateField formField" runat="server" DropDownCalendarID="shiftDateCalendar" TabIndex="5" StyleSetName="IG" OpenCalendarOnFocus="True" EditModeFormat="MM/dd/yyyy"></ig:WebDatePicker>
                                    <ig:WebMonthCalendar ID="shiftDateCalendar" CssClass="calendar" StyleSetName="IG" runat="server"></ig:WebMonthCalendar>
                                     
                                </div>
                                <div class="six column has-dropdown">
                                    <asp:Label runat="server" ID="shiftTimeInLabel" ClientIDMode="Static" CssClass="formLabel">Shift Time In<span class="required">*</span>
                                        <asp:RequiredFieldValidator runat="server" ID="shiftTimeIRequirednValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="shiftTimeIn" ValidationGroup="caseInfo" Display="Dynamic" Text="! A time is not selected." ></asp:RequiredFieldValidator>
                                        <asp:Label runat="server" ID="shiftTimeInValidator" ClientIDMode="Static" CSSClass="formValidator errorText requiredFieldValidator"></asp:Label>
                                    </asp:Label>
                                    
                                    <div class="clear"></div>
                                    <asp:DropDownList runat="server" ID="shiftTimeIn" ClientIDMode="Static" CssClass="caseInfo formDDL" TabIndex="6"></asp:DropDownList>
                                </div>
                                <div class="clear"></div>
                            </div>
                            <div id="shiftEndWrapper" class="twelve shiftEndWrapper">
                                <div id="" class="six shiftDateWrapper column">
                                    <asp:Label runat="server" ID="shiftEndDateLabel" ClientIDMode="Static" CssClass="formLabel">Shift End Date<span class="required">*</span>
                                        <asp:RequiredFieldValidator runat="server" ID="shiftEndDateRequiredValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="shiftEndDate" ValidationGroup="caseInfo" Display="Dynamic" Text="! A date is required."></asp:RequiredFieldValidator>
                                        <asp:RegularExpressionValidator runat="server" ID="shiftEndDateExpValidator" CssClass="formValidator" ClientIDMode="Static" ControlToValidate="shiftEndDate" ValidationGroup="caseInfo" Display="Dynamic" ValidationExpression="^(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.](19|20)\d\d$" Text="! Date is invalid."></asp:RegularExpressionValidator>
                                        <asp:Label runat="server" ID="shiftEndDateValidator" ClientIDMode="Static" CSSClass="formValidator errorText requiredFieldValidator"></asp:Label> 
                                    </asp:Label>
                                    <div class="clear"></div>
                                    <ig:WebDatePicker ID="shiftEndDate" ClientIDMode="Static" CssClass="dateField formField" runat="server" DropDownCalendarID="shiftEndDateCalendar" TabIndex="5" StyleSetName="IG" OpenCalendarOnFocus="True" EditModeFormat="MM/dd/yyyy" ></ig:WebDatePicker>
                                    <ig:WebMonthCalendar ID="shiftEndDateCalendar" CssClass="calendar" StyleSetName="IG" runat="server"></ig:WebMonthCalendar>
                                </div>

                                <div class="six column has-dropdown">
                                    <asp:Label runat="server" ID="shiftTimeOutLabel" ClientIDMode="Static" CssClass="formLabel">Shift Time Out<span class="required">*</span>
                                         <asp:RequiredFieldValidator runat="server" ID="shiftTimeOutValidator" ClientIDMode="Static" CssClass="formValidator" ControlToValidate="shiftTimeOut" ValidationGroup="caseInfo" Text="! A time is not selected."></asp:RequiredFieldValidator>
                                    </asp:Label>
                                   
                                    <div class="clear"></div>
                                    <asp:DropDownList runat="server" ID="shiftTimeOut" ClientIDMode="Static" CssClass="caseInfo formDDL" TabIndex="6"></asp:DropDownList>
                                </div>
                                <div class="clear"></div>
                            </div>

                        </asp:Panel>
                         
                        <div id="additionalCaseInfo" class="twelve clear">
                            <div id="notesWrapper" class="twelve">
                                <asp:Label runat="server" ID="notesLabel" ClientIDMode="Static" CssClass="formLabel">Notes (Required when specified)
                                    <asp:Label runat="server" ID="notesValidator" ClientIDMode="Static" CSSClass="formValidator errorText requiredFieldValidator">! Notes are required</asp:Label>
                                </asp:Label>
                                <asp:TextBox runat="server" ID="notes" ClientIDMode="Static" CssClass="caseInfo formField formTextArea" TabIndex="7" TextMode="MultiLine"></asp:TextBox>
                            </div>

                        </div>
                        
                        <div id="caseSubmitWrapper" class="row">
                            <button id="exitCaseBtn" class="medium button rightButton" >Exit Case</button>
                            <asp:Button ID="caseSubmitBtn" CssClass="medium button" ClientIDMode="Static" runat="server" Text="Save" ValidationGroup="caseInfo" TabIndex="8" />
                        </div>
                   </div>
                </fieldset>

            </asp:Panel>
        </ContentTemplate>
        <Triggers>
            <asp:AsyncPostBackTrigger ControlID="caseSubmitBtn" EventName="Click" />
        </Triggers>
    </asp:UpdatePanel>
    <asp:UpdateProgress runat="server" ID="UpdateProgress" AssociatedUpdatePanelID="contentUpdate" ClientIDMode="Static">
        <ProgressTemplate>
            <div id="savingModal" class="reveal-modal small">
                <p id="P1" class="">
                    <span id="modalMessage">Saving Information</span>...<br />
                    please wait
                </p>
                <div id="savingModalLoadingIconWrapper" class="one">
                    <img src="Images/loading_alt.gif" class="" alt="" id="" />
                </div>
            </div>
        </ProgressTemplate>
    </asp:UpdateProgress>
    <div id="exitModalbackground" class="modalBackground">

    </div>
    <div id="exitModal" class="reveal-modal small">
                <div id="exit">
                    <p id="P6" class="">
                    Exiting from this case will result in the case being closed and marked as an error.<br />
                    <span class="modalAlertMessage">Are you sure you want to proceed?</span>
                </p>
               <div id="exitModalSubmitWrapper" class="twelve">
                    <button id="exitModalCancelBtn" class="medium button rightButton">Cancel</button>
                    <asp:Button ID="exitSubmitBtn" CssClass="medium button" ClientIDMode="Static" runat="server" Text="Proceed" CausesValidation="false" />
               </div>
            </div>
        <div id="exitSave" class="hide">
            <p id="exitSaveMessage" class="">
                    <span id="">Saving Case</span>...<br />
                    please wait
                </p>
                <div id="savingModalLoadingIconWrapper" class="one">
                    <img src="Images/loading_alt.gif" class="" alt="" id="Img1" />
                </div>
        </div>
     </div>
    <script type="text/javascript">
        /* ================================================================================
          Functions
        =================================================================================*/

        function pageLoad(sender, args) {
            $(document).foundationCustomForms();
            $('#newCaseNextBtn').attr('disabled', true).addClass('disabled');
        }

        function employeeSearchResultsGrid_Grid_Click(sender, args) {
            var grid = $find("<%=employeeSearchResultsGrid.ClientID%>");
            var rows = grid.get_behaviors().get_selection().get_selectedRows();
            var row = rows.getItem(0);

            // When row is selected from employee search results capture employee information and store in  necase object
            if (selectedRow !== row.get_index()) {
                selectedRow = row.get_index();
                $('#employeeID').val(row.get_cell(0).get_text());
                $("#empName").val(row.get_cell(1).get_text() + ", " + row.get_cell(2).get_text() + " " + row.get_cell(3).get_text());


                newCase.EmployeeID = row.get_cell(0).get_text();
                newCase.LastName = row.get_cell(1).get_text();
                newCase.FirstName = row.get_cell(2).get_text();
                newCase.MI = row.get_cell(3).get_text();
                newCase.PhoneOne = row.get_cell(4).get_text();
                newCase.PhoneTwo = row.get_cell(5).get_text();
                newCase.Region = $('#region').children('option:selected').text();
                newCase.CaseType = $('#caseType').children('option:selected').text();

                $('#newCaseNextBtn').attr('disabled', false).removeClass('disabled');

            } else {
                if (rows !== null && rows !== undefined) {
                    rows.remove(rows.getItem(0));
                    selectedRow = null;
                }
            }

        }
        function initializeRequest(sender, args) {
            if (submitting === true) {
                // Remove error messages
                $('.requiredFieldValidator').hide();

                // Check Notes are entered for reason options that specify "Enter notes"
                // Check that shift date and times are valid
                var caseType = parseInt($('#caseTypeText').val());

                if ($('#reason').children('option:selected').text().indexOf("notes") > -1 && $('#notes').val() === "") {
                    $('#notesValidator').show();
                    args.set_cancel(true);
                    
                }else if(caseType <= 7){
                    var shiftDate = $find("<%=shiftDate.ClientID%>");
                    var sDate = new Date(shiftDate.get_text());

                    var shiftEndDate = $find("<%=shiftEndDate.ClientID%>");
                    var eDate = new Date(shiftEndDate.get_text());
                    var nextDay = new Date(sDate.getFullYear(), sDate.getMonth(), sDate.getDate() + 1);

                   

                    if (sDate.getTime() === eDate.getTime() || eDate.getTime() === nextDay.getTime()) {
                        var shiftTimeIn = new Date(shiftDate.get_text() +" " + $('#shiftTimeIn').val() + ':00');
                        var shiftTimeOut = new Date(shiftEndDate.get_text() +" " + $('#shiftTimeOut').val() + ':00');

                        if (shiftTimeIn > shiftTimeOut) {
                            args.set_cancel(true);
                            $('#shiftTimeInValidator').text('! Shift Time is after Shift End Time').show();
                        } else {
                            $('#modalMessage').text("Saving Case");
                            $('#savingModal').reveal({
                                closeOnBackgroundClick: false
                            });
                        }

                    } else {
                        if (sDate > eDate) {
                            $('#shiftDateValidator').text('! Shift Date is after Shift End Date').show();
                            args.set_cancel(true);
                        } else if (eDate.getMonth === sDate.getMonth && (eDate.getDate() - sDate.getDate()) > 1) {
                            $('#shiftEndDateValidator').text('! Greater than 1 day from Shift Date').show();
                            args.set_cancel(true);
                        } else if (eDate.getMonth() !== sDate.getMonth()) {
                            $('#shiftEndDateValidator').text('! Month does not match the Start Date').show();
                            args.set_cancel(true);
                        } else if (eDate.getYear() !== sDate.getMonth()) {
                            $('#shiftEndDateValidator').text('! Year does not match the Start Date').show();
                            args.set_cancel(true);
                        } else {
                            $('#modalMessage').text("Saving Case");
                            showModal();
                        }
                    }
                } else {
                    $('#modalMessage').text("Saving Case");
                    $('#savingModal').reveal({
                        closeOnBackgroundClick: false
                    });
                }
                
            } else if (exiting === true) {
                $('#modalMessage').text("Exiting Case");
                $('#savingModal').reveal({
                    closeOnBackgroundClick: false
                });

            } else {
                    // if new case is being entered////////////////////////////////
                    if (enterNewCaseInfo === true) {
                        ///  Check that the proper case types are selected
                       

                        if ($('#TypeOfCase').val() === 'Plaza' && ($('#caseType').val() !== '6' && $('#caseType').val() !== '9')) {
                            args.set_cancel(true);
                            $('#casetypeSearchValidator').text('! Case Type can not be used for plaza cases').show();
                        }else if($('#TypeOfCase').val() === 'Employee' &&  $('#caseType').val() === '6'){
                            args.set_cancel(true);
                            $('#casetypeSearchValidator').text('! Case Type can not be used for employee cases').show();
                        }else if($('#TypeOfCase').val() === 'Other'  && $('#caseType').val() !== '9') {
                            args.set_cancel(true);
                            $('#casetypeSearchValidator').text('! Only miscellaneous case type can be used').show();
                        }else{
                            $('#modalMessage').text("Creating Case");
                            $('#savingModal').reveal({
                                closeOnBackgroundClick: false
                            });
                        }
                       
                    } else {
                        /// CHeck that values have been entered in to fields for the selected search type
                        switch (newCaseSearchOption) {
                            case "Name":
                                if ($('#fName').val() === "" && $('#lName').val() === "") {
                                    args.set_cancel(true);
                                    $('#requiredNameValidator').show();
                                   
                                }
                                break;
                            case "EID":
                                if ($('#eid').val() === "") {
                                    args.set_cancel(true);
                                    $('#requiredEIDValidator').show();
                                }
                                break;
                            case "PhoneOne":
                                if ($('#phoneOne').val() === "") {
                                    args.set_cancel(true);
                                    $('#requiredPhoneValidator').show();
                                }
                                break;
                            case "PhoneTwo":
                                if ($('#phoneTwo').val() === "") {
                                    args.set_cancel(true);
                                    $('#requiredAltPhoneValidator').show();
                                }
                                break;
                            default:
                                break;
                        }

                        $('#modalMessage').text("Searching");
                        $('#savingModal').reveal({
                            closeOnBackgroundClick: false
                        });
                    }
                }
            
        }

        function EndRequest(sender, args) {
            if (args.get_error() !== undefined && args.get_error() !== null) {

                var m = args.get_error().message;
                var message = m.split(":");

                $('.search').show();
                $('#caseHeader').hide();
                $('#caseInfoWrapper').hide();
                $('#employeeSearchResultsGrid').hide();
                $('#resultsWrapper fieldset').css('background-color', 'rgba(190, 184, 184, 0.59)');
                $('#employeeSelectMessage').hide();
                $('#searchResultsMessage').text(message[1] + ':' + message[2]);
                $('#resultsAlertMessageWrapper').fadeIn(500).delay(10000).fadeOut();
                args.set_errorHandled(true);
                reset();

            } else if (enterNewCaseInfo === true && submitting == false) {
                $('.change').attr('disabled', true);
                $('#settingsBtn').attr('disabled', true);
                $('#headerLoginView_signOutBtn').attr('disabled', true);

                if ($('#TypeOfCase').val() === "Employee") {
                    $('#Name').text(newCase.LastName + ", " + newCase.FirstName + " " + newCase.MI);

                    $('#caseEID').text(newCase.EmployeeID).show();
                    $('#phoneOneText').text(newCase.PhoneOne).show();
                    $('#phoneTwoText').text(newCase.PhoneTwo).show();
                } 

                $('#caseNumberField').val($('#caseNumber').text());
                $('.search').hide();
                $('#caseHeader').toggle('fade');
                $('#caseInfoWrapper').toggle('fade');

                
            } else {


                var empGrid = $find("<%=employeeSearchResultsGrid.ClientID%>");
                var empRows = empGrid.get_behaviors().get_selection().get_selectedRows();


                if (empRows.get_length() > 0) {
                    empRows.remove(empRows.getItem(0));
                    selectedRow = null;
                }

                if (empGrid.get_rows().get_length() > 0) {
                    $('#resultsAlertMessageWrapper').hide();
                    $('#resultsWrapper fieldset').css('background-color', '#fff');
                    $('#employeeSelectMessage').toggle('fade');
                    $('#employeeSearchResultsGrid').toggle('slide', { 'direction': 'up' }, 500);
                } else {
                    $('#employeeSelectMessage').hide();
                    $('#employeeSearchResultsGrid').hide();
                    $('#resultsWrapper fieldset').css('background-color', 'rgba(190, 184, 184, 0.59)');
                    $('#resultsAlertMessageWrapper').fadeIn(500).delay(5000).fadeOut();
                }


                if (newCaseSearchOption !== 'Name') {
                    $('#newCaseNameField').hide();
                    $('#newCase' + newCaseSearchOption + 'Field').show();

                    if (newCaseSearchOption === "Plaza") {
                        $('#newCaseSearchBtn').attr('disabled', true).addClass('disabled');

                    } else {

                        $('#newCaseSearchBtn').attr('disabled', false).removeClass('disabled');

                    }

                }

            }
        }

        function reset() {
            $('.formField').val('');
            $('.formDDL').val('').trigger('change');


            if (enterNewCaseInfo === true) {
                enterNewCaseInfo = false;
            }

           if (submitting === true) {
                submitting = false;
            }



            if (newCaseSearchOption !== 'Name') {
                $('#newCaseNameField').hide();
                $('#newCase' + newCaseSearchOption + 'Field').show();

                if (newCaseSearchOption === "Plaza") {
                    $('#newCaseSearchBtn').attr('disabled', true).addClass('disabled');

                } else {

                    $('#newCaseSearchBtn').attr('disabled', false).removeClass('disabled');

                }

            }

        }



        /*============================================================================
        Events
        =============================================================================*/
        $(document).ready(function () {
            prm = Sys.WebForms.PageRequestManager.getInstance();
            prm.add_initializeRequest(initializeRequest);
            prm.add_endRequest(EndRequest);

            $(document.body).on('click', '#newCaseNextBtn', function () {
                enterNewCaseInfo = true;
                var grid = $find("<%=employeeSearchResultsGrid.ClientID%>");
                var rows = grid.get_behaviors().get_selection().get_selectedRows();
                var row = rows.getItem(0);

                if (rows !== null && rows !== undefined) {
                    rows.remove(rows.getItem(0));
                    selectedRow = null;
                 }
            });

            $(document.body).on('keypdown', function (e) {
                if (e.which == 13) {
                    if (enterNewCaseInfo === false && $('#employeeSearchResultsGrid').is(':visible') === false) {
                        $('#newCaseSearchBtn').focus();

                    } else if (enterNewCaseInfo === false && $('#employeeSearchResultsGrid').is(':visible') === true) {
                        $('#newCaseNextBtn').focus();
                    }
                    else if (enterNewCaseInfo === true) {
                        if ($('#notes').is(':focus') === false) {
                            $('#caseSubmitBtn').focus();
                        }
                    }
                }
            });




        });

       
    </script>

</asp:Content>
